<!DOCTYPE html>
<html>
<head>
  <title>Update Firestore Rules</title>
</head>
<body>
  <h2>Update Firestore Rules</h2>
  <p>Pravila morajo biti posodobljena v Firebase Console:</p>
  <ol>
    <li>Pojdi na: <a href="https://console.firebase.google.com/project/shareit-75a13/firestore/rules" target="_blank">Firebase Console - Firestore Rules</a></li>
    <li>Kopiraj spodnja pravila in jih prilepi</li>
    <li>Klikni "Publish"</li>
  </ol>
  
  <h3>Nova pravila (brez email verification):</h3>
  <textarea id="rules" style="width: 100%; height: 400px; font-family: monospace;">rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Users can read/write only their own user document
    match /users/{userId} {
      allow read, update, delete: if request.auth != null && request.auth.uid == userId;
      allow create: if request.auth != null && request.auth.uid == userId;
    }

    // Public items are readable by anyone. Writes require ownership (email verification removed for testing).
    match /items/{itemId} {
      allow read: if true;
      allow create: if request.auth != null &&
        request.resource.data.ownerUid == request.auth.uid;
      allow update: if request.auth != null && (
        resource.data.ownerUid == request.auth.uid ||
        request.resource.data.diff(resource.data).changedKeys().hasOnly(['ratingAvg', 'ratingCount'])
      );
      allow delete: if request.auth != null &&
        resource.data.ownerUid == request.auth.uid;
    }

    // Bookings: only the renter (renterUid) and item owner (ownerUid) can read/write.
    match /bookings/{bookingId} {
      allow read: if request.auth != null && (
        request.auth.uid == resource.data.renterUid ||
        request.auth.uid == resource.data.ownerUid
      );

      allow create: if request.auth != null &&
        request.resource.data.renterUid == request.auth.uid;

      allow update, delete: if request.auth != null && (
        request.auth.uid == resource.data.renterUid ||
        request.auth.uid == resource.data.ownerUid
      );
    }

    // Chats: only participants can read/write.
    match /chats/{chatId} {
      allow read: if request.auth != null && request.auth.uid in resource.data.participants;
      allow create: if request.auth != null && request.auth.uid in request.resource.data.participants;
      allow update: if request.auth != null && request.auth.uid in resource.data.participants;
      allow delete: if false;
    }

    match /chats/{chatId}/messages/{messageId} {
      allow read: if request.auth != null && request.auth.uid in get(/databases/$(database)/documents/chats/$(chatId)).data.participants;
      allow create: if request.auth != null &&
        request.auth.uid in get(/databases/$(database)/documents/chats/$(chatId)).data.participants &&
        request.resource.data.senderUid == request.auth.uid;
      allow update, delete: if false;
    }

    // Default deny for everything else
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
</textarea>
  
  <button onclick="copyRules()">Kopiraj pravila</button>
  <p id="status"></p>
  
  <script>
    function copyRules() {
      const textarea = document.getElementById('rules');
      textarea.select();
      document.execCommand('copy');
      document.getElementById('status').textContent = 'âœ“ Pravila kopirana! Pojdi na Firebase Console in jih prilepi.';
    }
  </script>
</body>
</html>
